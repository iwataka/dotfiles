#!/usr/bin/env bash

set -e

install_requirements() {
    local platform=$(uname -s)
    if [[ $platform == "Linux" ]]
    then
        apt-get --version &> /dev/null
        local apt_get_found=$(("$?" == 0))
        if $apt_get_found
        then
            sudo apt-get install libtool libtool-bin autoconf automake cmake g++ pkg-config unzip
        fi
    fi
}

if [[ ! -d ~/lib/neovim ]]
then
    install_requirements
    git clone https://github.com/neovim/neovim ~/lib/neovim
    cd ~/lib/neovim && make
elif [[ "$1" == "--upgrade" ]]
then
    cd ~/lib/neovim
    git pull origin master
    make
else
    ~/lib/neovim/build/bin/nvim "$@"
fi
